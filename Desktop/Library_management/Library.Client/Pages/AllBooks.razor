@page "/books"
@using LMS.CLient.Services
@using LMS.Library.DTOs
@inject IJSRuntime JS
@inject StudentService studentService

<h3 class="mb-4">Books</h3>

@if (books == null)
{
    <p>Loading books...</p>
}
else if (!books.Any())
{
    <p>No books available.</p>
}
else
{
    <div class="row">
        @foreach (var book in books)
        {
            <div class="col-md-4 mb-4">
                <div class="card h-100 shadow-sm">

                    <img src="@book.ImageUrl"
                         class="card-img-top"
                         alt="@book.BookName"
                         style="height:200px; object-fit:cover;" />

                    <div class="card-body d-flex flex-column">
                        <h5 class="card-title">@book.BookName</h5>

                        <p class="text-muted mb-1">
                            <strong>Author:</strong> @book.Author
                        </p>

                        <p class="card-text">@book.Description</p>

                        <p class="mt-auto">
                            <strong>Copies:</strong> @book.Copies
                        </p>
                    </div>

                    <div class="d-flex justify-content-center mb-2">
                        <button class="btn btn-success"
                                @onclick="() => HandleRequestIssue(book.BookId)"
                                disabled="@(book.Copies == 0)">
                            Request issue
                        </button>
                    </div>

                </div>
            </div>
        }
    </div>
}

@code {
    private List<BookDto> books = new();

    protected override async Task OnInitializedAsync()
    {
        books = await studentService.GetAllBooksAsync();
    }

    private async Task HandleRequestIssue(int bookId)
    {
        var request = new RequestBook
        {
            BookId = bookId
        };

        await studentService.RequestBookAsync(request);
        await JS.InvokeVoidAsync("alert", "Book requested successfully");
    }
}
